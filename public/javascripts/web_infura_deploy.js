$(document).ready(function() { 


filepath = 'voting.sol'
target = 'voting'
contract_name ='TrustMe'
args = [];
if (typeof window.web3 === 'undefined') {
    // no web3, use fallback
    console.error("Please use a web3 browser");
	var web3 = new Web3(new Web3.providers.HttpProvider('https://rinkeby.infura.io/sFoiW6c7EIGuXLGcq08X'));
	console.log('we ll use this web3', web3);
	//$('#emptymodal').modal('show');
  } else {
    // window.web3 == web3 most of the time. Don't override the provided,
    // web3, just wrap it in your Web3.
    var web3 = new Web3(window.web3.currentProvider); 

    // the default account doesn't seem to be persisted, copy it to our
    // new instance
    web3.eth.defaultAccount = window.web3.eth.defaultAccount;
  }
coinbase = '0xc3c0B5Be1F04AaEEf7478C01937B619f37D6d8B9'


const asciiToHex = Web3.utils.asciiToHex;

const countries_t = ["AFG","AGO","ALB","ARE","ARG","ARM","ATA","ATF","AUS","AUT","AZE","BDI","BEL","BEN","BFA","BGD","BGR","BHS","BIH","BLR","BLZ","BOL","BRA","BRN","BTN","BWA","CAF","CAN","CHE","CHL","CHN","CIV","CMR","COD","COG","COL","CRI","CUB","-99","CYP","CZE","DEU","DJI","DNK","DOM","DZA","ECU","EGY","ERI","ESP","EST","ETH","FIN","FJI","FLK","FRA","GUF","GAB","GBR","GEO","GHA","GIN","GMB","GNB","GNQ","GRC","GRL","GTM","GUY","HND","HRV","HTI","HUN","IDN","IND","IRL","IRN","IRQ","ISL","ISR","ITA","JAM","JOR","JPN","KAZ","KEN","KGZ","KHM","KOR","-99","KWT","LAO","LBN","LBR","LBY","LKA","LSO","LTU","LUX","LVA","MAR","MDA","MDG","MEX","MKD","MLI","MMR","MNE","MNG","MOZ","MRT","MWI","MYS","NAM","NCL","NER","NGA","NIC","NLD","NOR","NPL","NZL","OMN","PAK","PAN","PER","PHL","PNG","POL","PRI","PRK","PRT","PRY","QAT","ROU","RUS","RWA","ESH","SAU","SDN","SSD","SEN","SLB","SLE","SLV","-99","SOM","SRB","SUR","SVK","SVN","SWE","SWZ","SYR","TCD","TGO","THA","TJK","TKM","TLS","TTO","TUN","TUR","TWN","TZA","UGA","UKR","URY","USA","UZB","VEN","VNM","VUT","PSE","YEM","ZAF","ZMB","ZWE"]

for (i=0; i<countries_t.length;i++){
	console.log('c '+countries_t[i]+' asciiToHex( countries_t[i])',asciiToHex( countries_t[i]))
	args.push(asciiToHex( countries_t[i]))
}



  console.log('account', coinbase);

  
  
  const byteCode = '60606040527f3078343136363637363836313665363937333734363136653064000000000000600090600019169055606060405190810160405280600160ff168152602001600360ff168152602001600460ff16815250600190600362000068929190620001a9565b506001600860006101000a81548160ff0219169083151502179055506000600860016101000a81548160ff0219169083151502179055506001600b556064600b54811515620000b357fe5b04600c5573a6a0ef616bfef6fe29685cf22bb42a2e6c3731f1600d60006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555073c34521c41e1859535631f1928873ab518195ca6e600e60006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555060c560155560026016556040516200181738038062001817833981016040528080518201919050508060139080519060200190620001a192919062000200565b5050620002a8565b828054828255906000526020600020908101928215620001ed579160200282015b82811115620001ec578251829060ff16905591602001919060010190620001ca565b5b509050620001fc919062000258565b5090565b82805482825590600052602060002090810192821562000245579160200282015b828111156200024457825182906000191690559160200191906001019062000221565b5b50905062000254919062000280565b5090565b6200027d91905b80821115620002795760008160009055506001016200025f565b5090565b90565b620002a591905b80821115620002a157600081600090555060010162000287565b5090565b90565b61155f80620002b86000396000f3006060604052600436106100db576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063020e0272146100e05780630b40bd881461015c5780631ade056e146101d557806321a38aa714610218578063329d39e31461027b5780633d5bb55e146102d85780636321ef6c1461031957806377edf96d146103765780637985d559146103aa578063a5d49e1e14610432578063beca80091461045b578063c5503520146104c5578063eb6b662b146104fe578063f03726371461053d578063fa5db6a9146105a4575b600080fd5b34156100eb57600080fd5b61010560048080356000191690602001909190505061062c565b6040518080602001828103825283818151815260200191508051906020019060200280838360005b8381101561014857808201518184015260208101905061012d565b505050509050019250505060405180910390f35b341561016757600080fd5b6101bb600480803573ffffffffffffffffffffffffffffffffffffffff1690602001909190803573ffffffffffffffffffffffffffffffffffffffff1690602001909190803590602001909190505061078e565b604051808215151515815260200191505060405180910390f35b34156101e057600080fd5b6101fa600480803560001916906020019091905050610940565b604051808261ffff1661ffff16815260200191505060405180910390f35b341561022357600080fd5b6102396004808035906020019091905050610a21565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b341561028657600080fd5b6102ba6004808035600019169060200190919080356000191690602001909190803560001916906020019091905050610a5e565b604051808261ffff1661ffff16815260200191505060405180910390f35b34156102e357600080fd5b6103176004808035600019169060200190919080356000191690602001909190803560001916906020019091905050610ac5565b005b341561032457600080fd5b6103586004808035600019169060200190919080356000191690602001909190803560001916906020019091905050610c98565b604051808261ffff1661ffff16815260200191505060405180910390f35b610390600480803560001916906020019091905050610cd5565b604051808215151515815260200191505060405180910390f35b34156103b557600080fd5b6103cf600480803560001916906020019091905050610fe0565b6040518085600019166000191681526020018473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018381526020018215151515815260200194505050505060405180910390f35b341561043d57600080fd5b61044561109e565b6040518082815260200191505060405180910390f35b341561046657600080fd5b61046e6110a4565b6040518080602001828103825283818151815260200191508051906020019060200280838360005b838110156104b1578082015181840152602081019050610496565b505050509050019250505060405180910390f35b34156104d057600080fd5b6104fc600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091905050611106565b005b341561050957600080fd5b61051f6004808035906020019091905050611175565b60405180826000191660001916815260200191505060405180910390f35b341561054857600080fd5b610562600480803560001916906020019091905050611199565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b34156105af57600080fd5b6105c96004808035600019169060200190919050506111e1565b6040518085600019166000191681526020018473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018381526020018215151515815260200194505050505060405180910390f35b6106346114ce565b6000806006600085600019166000191681526020019081526020016000206000806001026000191681526020019081526020016000206000600860009054906101000a900460ff161515151581526020019081526020016000205490505b60006001028160001916141515610731578180548060010182816106b691906114e2565b916000526020600020900160008390919091509060001916905550600660008560001916600019168152602001908152602001600020600082600019166000191681526020019081526020016000206000600860009054906101000a900460ff16151515158152602001908152602001600020549050610692565b8180548060200260200160405190810160405280929190818152602001828054801561078057602002820191906000526020600020905b81546000191681526020019060010190808311610768575b505050505092505050919050565b6000806010600060115481526020019081526020016000209050848160000160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550828160010181905550838160020160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508060000160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663a9059cbb85856000604051602001526040518363ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200182815260200192505050602060405180830381600087803b151561090657600080fd5b6102c65a03f1151561091757600080fd5b505050604051805190505060116000815480929190600101919050555060019150509392505050565b60008060006006600085600019166000191681526020019081526020016000206000806001026000191681526020019081526020016000206000600860009054906101000a900460ff161515151581526020019081526020016000205490505b60006001028160001916141515610a1757600182019150600660008560001916600019168152602001908152602001600020600082600019166000191681526020019081526020016000206000600860009054906101000a900460ff161515151581526020019081526020016000205490506109a0565b8192505050919050565b6000600a600083815260200190815260200160002060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff169050919050565b6000600960008560001916600019168152602001908152602001600020600084600019166000191681526020019081526020016000206000836000191660001916815260200190815260200160002060009054906101000a900461ffff1690509392505050565b6000600960008560001916600019168152602001908152602001600020600084600019166000191681526020019081526020016000206000836000191660001916815260200190815260200160002060009054906101000a900461ffff1661ffff161415610b78577fd782e9891c43a9c77db1da59a87eb28723a56aec40059de06d06e28a2c128e72605880604051808381526020018281526020019250505060405180910390a1610b77828261123e565b5b6001600960008560001916600019168152602001908152602001600020600084600019166000191681526020019081526020016000206000836000191660001916815260200190815260200160002060008282829054906101000a900461ffff160192506101000a81548161ffff021916908361ffff1602179055507fd782e9891c43a9c77db1da59a87eb28723a56aec40059de06d06e28a2c128e726064600960008660001916600019168152602001908152602001600020600085600019166000191681526020019081526020016000206000846000191660001916815260200190815260200160002060009054906101000a900461ffff16604051808381526020018261ffff1681526020019250505060405180910390a1505050565b6009602052826000526040600020602052816000526040600020602052806000526040600020600092509250509054906101000a900461ffff1681565b600060146000836000191660001916815260200190815260200160002060030160009054906101000a900460ff161515610e96577fd782e9891c43a9c77db1da59a87eb28723a56aec40059de06d06e28a2c128e72600780604051808381526020018281526020019250505060405180910390a1600034118015610d5a5750600c5434115b15610e8d577f44f4ef85c6e5ce36abb14e841e7afe4d9daaeeb2802449984658b8cf76f0304882346040518083600019166000191681526020018281526020019250505060405180910390a1608060405190810160405280836000191681526020013373ffffffffffffffffffffffffffffffffffffffff168152602001348152602001600115158152506014600084600019166000191681526020019081526020016000206000820151816000019060001916905560208201518160010160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506040820151816002015560608201518160030160006101000a81548160ff02191690831515021790555090505060019050610fdb565b60009050610fdb565b7fd782e9891c43a9c77db1da59a87eb28723a56aec40059de06d06e28a2c128e72600080604051808381526020018281526020019250505060405180910390a1600034118015610f075750601654601460008460001916600019168152602001908152602001600020600201540234115b15610fd6577fd782e9891c43a9c77db1da59a87eb28723a56aec40059de06d06e28a2c128e7260016000604051808381526020018281526020019250505060405180910390a13360146000846000191660001916815260200190815260200160002060010160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550346014600084600019166000191681526020019081526020016000206002018190555060019050610fdb565b600190505b919050565b6000806000806014600086600019166000191681526020019081526020016000206000015460146000876000191660001916815260200190815260200160002060010160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff166014600088600019166000191681526020019081526020016000206002015460146000896000191660001916815260200190815260200160002060030160009054906101000a900460ff1693509350935093509193509193565b600c5481565b6110ac6114ce565b60138054806020026020016040519081016040528092919081815260200182805480156110fc57602002820191906000526020600020905b815460001916815260200190600101908083116110e4575b5050505050905090565b600081905081600a6000601254815260200190815260200160002060006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506012600081548092919060010191905055505050565b60138181548110151561118457fe5b90600052602060002090016000915090505481565b600060146000836000191660001916815260200190815260200160002060010160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff169050919050565b60146020528060005260406000206000915090508060000154908060010160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16908060020154908060030160009054906101000a900460ff16905084565b6000600102600660008460001916600019168152602001908152602001600020600083600019166000191681526020019081526020016000206000600860019054906101000a900460ff1615151515815260200190815260200160002081600019169055506006600083600019166000191681526020019081526020016000206000806001026000191681526020019081526020016000206000600860009054906101000a900460ff1615151515815260200190815260200160002054600660008460001916600019168152602001908152602001600020600083600019166000191681526020019081526020016000206000600860009054906101000a900460ff161515151581526020019081526020016000208160001916905550806006600084600019166000191681526020019081526020016000206000806001026000191681526020019081526020016000206000600860009054906101000a900460ff1615151515815260200190815260200160002081600019169055506006600083600019166000191681526020019081526020016000206000806001026000191681526020019081526020016000206000600860009054906101000a900460ff161515151581526020019081526020016000205460066000846000191660001916815260200190815260200160002060006006600086600019166000191681526020019081526020016000206000806001026000191681526020019081526020016000206000600860009054906101000a900460ff1615151515815260200190815260200160002054600019166000191681526020019081526020016000206000600860019054906101000a900460ff1615151515815260200190815260200160002081600019169055505050565b602060405190810160405280600081525090565b81548183558181151161150957818360005260206000209182019101611508919061150e565b5b505050565b61153091905b8082111561152c576000816000905550600101611514565b5090565b905600a165627a7a723058203ac17b67ab064e8b8870ea39f34327d355d82533647e81c8da69c76520ecc5f50029'
   //console.log('byteCode', byteCode);
  const abiDefinition = [{"constant":true,"inputs":[{"name":"prod","type":"bytes32"}],"name":"getModalities","outputs":[{"name":"","type":"bytes32[]"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"coinContractAddress","type":"address"},{"name":"receiver","type":"address"},{"name":"amount","type":"uint256"}],"name":"sendCoin","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"prod","type":"bytes32"}],"name":"getLenModalities","outputs":[{"name":"","type":"uint16"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"symb","type":"uint256"}],"name":"getTokenProviderAddress","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"prov","type":"bytes32"},{"name":"prod","type":"bytes32"},{"name":"moda","type":"bytes32"}],"name":"getRank","outputs":[{"name":"","type":"uint16"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"prov","type":"bytes32"},{"name":"prod","type":"bytes32"},{"name":"moda","type":"bytes32"}],"name":"rank","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"","type":"bytes32"},{"name":"","type":"bytes32"},{"name":"","type":"bytes32"}],"name":"Ranks","outputs":[{"name":"","type":"uint16"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"counId","type":"bytes32"}],"name":"becomeAKing","outputs":[{"name":"","type":"bool"}],"payable":true,"stateMutability":"payable","type":"function"},{"constant":true,"inputs":[{"name":"countryID","type":"bytes32"}],"name":"getCountryInfo","outputs":[{"name":"","type":"bytes32"},{"name":"","type":"address"},{"name":"","type":"uint256"},{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"minimal_price","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getCountries","outputs":[{"name":"","type":"bytes32[]"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"token_address","type":"address"}],"name":"addTokenProvider","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"Countries","outputs":[{"name":"","type":"bytes32"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"counId","type":"bytes32"}],"name":"getKing","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"bytes32"}],"name":"WCountries","outputs":[{"name":"country_id","type":"bytes32"},{"name":"country_king","type":"address"},{"name":"price","type":"uint256"},{"name":"taken","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"inputs":[{"name":"countries_","type":"bytes32[]"}],"payable":true,"stateMutability":"payable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":false,"name":"rank","type":"uint256"},{"indexed":false,"name":"prodIndex","type":"uint256"}],"name":"RankH","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"mod","type":"bytes32"}],"name":"Mod","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"symbol","type":"uint256"},{"indexed":false,"name":"addr","type":"address"}],"name":"ProvA","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"r","type":"bytes32"},{"indexed":false,"name":"g","type":"uint256"}],"name":"RankG","type":"event"}];
   //console.log('abiDefinition', compiledCode.contracts[':'+contract_name].interface);
   web3.eth.getBalance(coinbase, function(e,b){console.log('la balance de ',coinbase,'est de : ',b);});
  const VotingContract = new web3.eth.Contract(abiDefinition,
    {data: '0x'+byteCode, from: coinbase, gas: 21000000}
  );
   //console.log('VotingContract', VotingContract);
  let deployedContract = null ;
  
  var vcd =  VotingContract.deploy({arguments: [args]})//{countries:countries_}
  
  var vcd2=   vcd.send(function(error, transactionHash){ 
		 console.log('deploy transactionHash', transactionHash);
		})
		 .on('error', function(error){ console.log('error on deploy ',error);})
		
	     .then((result) => {
		    console.log('Contract ',contract_name,' adress : ',result.options.address);
			deployedContract = result.options.address ; // must return not log !
			return result.options.address;
	    }) 
		
		 return {
        address: deployedContract,
        abi: abiDefinition
    };
});